<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Test - Accounting Fundamentals</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>Session Test</h1>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="login.html">Login</a></li>
                    <li><a href="register.html">Register</a></li>
                    
                    <li class="logged-out"><a href="register.html">Register</a></li>
                    <li class="logged-out"><a href="login.html" id="login-btn">Login</a></li>
                    
                    <li class="logged-in" style="display: none;">
                        <span id="nav-username" style="color: white; padding: 10px 18px;"></span>
                    </li>
                    <li class="logged-in" style="display: none;">
                        <a href="#" id="logout-btn">Logout</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container content-page">
        <h2>Session Debug Information</h2>
        <div id="debug-info" style="background: #f5f5f5; padding: 20px; border-radius: 5px; margin: 20px 0;">
            <h3>Debug Information:</h3>
            <div id="session-status">Checking session...</div>
            <div id="element-status">Checking elements...</div>
        </div>
        
        <div style="margin-top: 20px;">
            <button onclick="checkSession()" class="button">Check Session</button>
            <button onclick="showAllElements()" class="button">Show All Elements</button>
            <button onclick="hideAllElements()" class="button">Hide All Elements</button>
        </div>
    </main>

    <script>
        function checkSession() {
            console.log('Checking session...');
            fetch('http://localhost:5000/api/check_session', { credentials: 'include' })
                .then(response => response.json())
                .then(data => {
                    console.log('Session data:', data);
                    document.getElementById('session-status').innerHTML = `
                        <strong>Session Response:</strong><br>
                        Logged in: ${data.logged_in}<br>
                        Username: ${data.username || 'N/A'}<br>
                        Raw data: ${JSON.stringify(data)}
                    `;
                    
                    // Update UI based on session
                    const loggedInElements = document.querySelectorAll('.logged-in');
                    const loggedOutElements = document.querySelectorAll('.logged-out');
                    const usernameSpan = document.getElementById('nav-username');
                    
                    if (data.logged_in) {
                        loggedInElements.forEach(el => {
                            el.style.display = 'inline-block';
                            console.log('Showing logged-in element:', el);
                        });
                        loggedOutElements.forEach(el => {
                            el.style.display = 'none';
                            console.log('Hiding logged-out element:', el);
                        });
                        if (usernameSpan) {
                            usernameSpan.textContent = `Welcome, ${data.username}`;
                        }
                    } else {
                        loggedInElements.forEach(el => {
                            el.style.display = 'none';
                            console.log('Hiding logged-in element:', el);
                        });
                        loggedOutElements.forEach(el => {
                            el.style.display = 'inline-block';
                            console.log('Showing logged-out element:', el);
                        });
                    }
                })
                .catch(error => {
                    console.error('Session check error:', error);
                    document.getElementById('session-status').innerHTML = `Error: ${error.message}`;
                });
        }
        
        function showAllElements() {
            const loggedInElements = document.querySelectorAll('.logged-in');
            const loggedOutElements = document.querySelectorAll('.logged-out');
            
            loggedInElements.forEach(el => el.style.display = 'inline-block');
            loggedOutElements.forEach(el => el.style.display = 'inline-block');
            
            document.getElementById('element-status').innerHTML = 'All elements are now visible';
        }
        
        function hideAllElements() {
            const loggedInElements = document.querySelectorAll('.logged-in');
            const loggedOutElements = document.querySelectorAll('.logged-out');
            
            loggedInElements.forEach(el => el.style.display = 'none');
            loggedOutElements.forEach(el => el.style.display = 'none');
            
            document.getElementById('element-status').innerHTML = 'All elements are now hidden';
        }
        
        // Check session on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkSession();
        });
    </script>
</body>
</html> 